name: Data Product Deployment
trigger:
  branches:
    include:
    - main
  paths:
    include:
    - infra/ApplicationInsights/*
    - infra/BigDataPool/*
    - infra/CognitiveServices/*
    - infra/ContainerRegistry/*
    - infra/DataFactory/*
    - infra/KeyVault/*
    - infra/LogicApps/*
    - infra/MachineLearning/*
    - infra/MachineLearningAks/*
    - infra/MachineLearningCluster/*
    - infra/MachineLearningComputeInstance/*
    - infra/MachineLearningSynapse/*
    - infra/Search/*
    - infra/SqlPool/*
    - infra/Storage/*
    - infra/Synapse/*
    - .ado/workflows/dataProductDeployment.yml
variables:
  AZURE_RESOURCE_MANAGER_CONNECTION_NAME: False
  AZURE_SUBSCRIPTION_ID: <my-data-landing-zone-subscription-id>
  AZURE_RESOURCE_GROUP_NAME: <my-data-landing-zone-name>-rg
  AZURE_LOCATION: <my-region>
stages:
- stage: Validation
  displayName: Validation of ARM templates
  jobs:
  - job: Validation
    displayName: Validation of ARM templates
    continueOnError: false
    pool:
      vmImage: ubuntu-latest
    steps:
    - checkout: self
      name: checkout_repository
      displayName: Checkout repository
      submodules: true
      lfs: false
      clean: true
      continueOnError: false
      enabled: true
    - task: AzureResourceManagerTemplateDeployment@3
      name: key_vault_001_validation
      displayName: Deploy Key Vault 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/deploy.keyVault.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/params.keyVault001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: key_vault_002_validation
      displayName: Deploy Key Vault 002 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/deploy.keyVault.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/params.keyVault002.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: storage_account_001_validation
      displayName: Deploy Storage Account 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Storage/deploy.storage.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Storage/params.storage001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: application_insights_001_validation
      displayName: Deploy Application Insights 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/ApplicationInsights/deploy.applicationInsights.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/ApplicationInsights/params.applicationInsights001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: container_registry_001_validation
      displayName: Deploy Container Registry 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/ContainerRegistry/deploy.containerRegistry.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/ContainerRegistry/params.containerRegistry001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_001_validation
      displayName: Deploy Machine Learning 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearning/deploy.machineLearning.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearning/params.machineLearning001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_cluster_001_validation
      displayName: Deploy Machine Learning Cluster 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningCluster/deploy.machineLearningCluster.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningCluster/params.machineLearningCluster001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_compute_instance_001_validation
      displayName: Deploy Machine Learning Compute Instance 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningComputeInstance/deploy.machineLearningComputeInstance.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningComputeInstance/params.machineLearningComputeInstance001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_aks_001_validation
      displayName: Deploy Machine Learning AKS 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningAks/deploy.machineLearningAks.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningAks/params.machineLearningAks001.json
        deploymentMode: Validation
    - task: PowerShell@2
      name: generate_password_001
      displayName: Generate Password 001
      enabled: true
      continueOnError: false
      inputs:
        targetType: filePath
        filePath: $(System.DefaultWorkingDirectory)/code/GeneratePassword.ps1
        errorActionPreference: stop
        failOnStderr: false
        ignoreLASTEXITCODE: false
        pwsh: true
    - task: AzureResourceManagerTemplateDeployment@3
      name: synapse_001_validation
      displayName: Deploy Synapse 001 - validation
      enabled: false
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Synapse/deploy.synapse.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Synapse/params.synapse001.json
        deploymentMode: Validation
        overrideParameters: |
          -synapseSqlAdministratorPassword "$(password)"
    - task: AzureResourceManagerTemplateDeployment@3
      name: sql_pool_001_validation
      displayName: Deploy SQL Pool 001 - validation
      enabled: false
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/SqlPool/deploy.sqlPool.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/SqlPool/params.sqlPool001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: big_data_pool_001_validation
      displayName: Deploy Big Data Pool 001 - validation
      enabled: false
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/BigDataPool/deploy.bigDataPool.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/BigDataPool/params.bigDataPool001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_synapse_001_validation
      displayName: Deploy Machine Learning Synapse 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningSynapse/deploy.machineLearningSynapse.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningSynapse/params.machineLearningSynapse001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: cogitive_services_001_validation
      displayName: Deploy Cognitive Services 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/CognitiveServices/deploy.cognitiveService.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/CognitiveServices/params.cognitiveService001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: search_001_validation
      displayName: Deploy Search 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Search/deploy.search.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Search/params.search001.json
        deploymentMode: Validation
    - task: AzureResourceManagerTemplateDeployment@3
      name: data_factory_001_validation
      displayName: Deploy Data Factory 001 - validation
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/DataFactory/deploy.dataFactory.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/DataFactory/params.dataFactory001.json
        deploymentMode: Validation
- stage: Deployment
  displayName: Deployment of ARM templates
  dependsOn: Validation
  condition: succeeded()
  jobs:
  - job: Deployment
    displayName: Deployment of ARM templates
    continueOnError: false
    pool:
      vmImage: ubuntu-latest
    steps:
    - checkout: self
      name: checkout_repository
      displayName: Checkout repository
      submodules: true
      lfs: false
      clean: true
      continueOnError: false
      enabled: true
    - task: AzureResourceManagerTemplateDeployment@3
      name: key_vault_001_deployment
      displayName: Deploy Key Vault 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/deploy.keyVault.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/params.keyVault001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: key_vault_002_deployment
      displayName: Deploy Key Vault 002
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/deploy.keyVault.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/KeyVault/params.keyVault002.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: storage_account_001_deployment
      displayName: Deploy Storage Account 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Storage/deploy.storage.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Storage/params.storage001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: application_insights_001_deployment
      displayName: Deploy Application Insights 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/ApplicationInsights/deploy.applicationInsights.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/ApplicationInsights/params.applicationInsights001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: container_registry_001_deployment
      displayName: Deploy Container Registry 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/ContainerRegistry/deploy.containerRegistry.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/ContainerRegistry/params.containerRegistry001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_001_deployment
      displayName: Deploy Machine Learning 001
      enabled: true
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearning/deploy.machineLearning.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearning/params.machineLearning001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: machine_learning_cluster_001_deployment
      displayName: Deploy Machine Learning Cluster 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningCluster/deploy.machineLearningCluster.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/MachineLearningCluster/params.machineLearningCluster001.json
        deploymentMode: Incremental
    - task: PowerShell@2
      name: generate_password_001
      displayName: Generate Password 001
      enabled: true
      continueOnError: false
      inputs:
        targetType: filePath
        filePath: $(System.DefaultWorkingDirectory)/code/GeneratePassword.ps1
        errorActionPreference: stop
        failOnStderr: false
        ignoreLASTEXITCODE: false
        pwsh: true
    - task: AzureResourceManagerTemplateDeployment@3
      name: synapse_001_deployment
      displayName: Deploy Synapse 001
      enabled: false
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Synapse/deploy.synapse.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Synapse/params.synapse001.json
        deploymentMode: Incremental
        overrideParameters: |
          -synapseSqlAdministratorPassword "$(password)"
    - task: AzureResourceManagerTemplateDeployment@3
      name: big_data_pool_001_deployment
      displayName: Deploy Big Data Pool 001
      enabled: false
      continueOnError: true
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/BigDataPool/deploy.bigDataPool.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/BigDataPool/params.bigDataPool001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: cogitive_services_001_deployment
      displayName: Deploy Cognitive Services 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/CognitiveServices/deploy.cognitiveService.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/CognitiveServices/params.cognitiveService001.json
        deploymentMode: Incremental
    - task: AzureResourceManagerTemplateDeployment@3
      name: search_001_deployment
      displayName: Deploy Search 001
      enabled: true
      continueOnError: false
      inputs:
        deploymentScope: Resource Group
        azureResourceManagerConnection: $(AZURE_RESOURCE_MANAGER_CONNECTION_NAME)
        subscriptionId: $(AZURE_SUBSCRIPTION_ID)
        action: Create Or Update Resource Group
        resourceGroupName: $(AZURE_RESOURCE_GROUP_NAME)
        location: $(AZURE_LOCATION)
        templateLocation: Linked artifact
        csmFile: $(System.DefaultWorkingDirectory)/infra/Search/deploy.search.json
        csmParametersFile: $(System.DefaultWorkingDirectory)/infra/Search/params.search001.json
        deploymentMode: Incremental

