{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics - Data Product Analytics",
            "steps": [
                {
                    "name": "basics",
                    "label": "Data Product",
                    "elements": [
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "deploymentDetailsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the subscription and resource group as well as the location to specify the scope of your Data Product deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "infoBoxEnterpriseScaleAnalytics",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Enterprise-Scale Analytics is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                        "style": "Info",
                                        "uri": "https://aka.ms/adopt/datamanagement"
                                    }
                                },
                                {
                                    "name": "infoBoxPrerequisites",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Please make sure that you have a Data Management Zone and Data Landing Zone deployed before deploying a Data Product or Data Integration template.",
                                        "style": "Warning",
                                        "uri": "https://github.com/Azure/data-management-zone"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Data Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "resourceGroupApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/resourcegroups?api-version=2020-01-01')]"
                                    }
                                },
                                {
                                    "name": "resourceGroupId",
                                    "label": "Resource Group",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Resource Group for your Data Product Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.resourceGroupApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Subscription ID: ', last(take(split(item.id, '/'), 3)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise Scale Analytics is available in a subset of regions.",
                                        "style": "Info",
                                        "uri": ""
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Data Product Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataProductName",
							"label": "Data Product Name",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataPruductNamesText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify a prefix and environment name which will be used as a prefix for all resource names.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "dataProductPrefix",
                                    "label": "Data Product Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9]{1,10}$",
                                        "validationMessage": "The prefix must be between 1-10 lowercase characters and numbers."
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the environment for the deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
				{
					"name": "generalSettings",
					"label": "General Settings",
					"subLabel": {
						"preValidation": "Provide settings for your data product analytics deployment.",
                        "postValidation": "Done"
					},
					"bladeTitle": "Data Product Settings",
                    "bladeSubtitle": "Data Product Settings",
					"elements": [
                        {
							"name": "machineLearningSettings",
							"label": "Machine Learning Settings",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "enableComputeInstance",
                                    "label": "Create Machine Learning Compute Instance",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'Yes' is selected, you are required to provide an AAD User Object ID.",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "infoBoxComputeInstance",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableComputeInstance, 'yes')]",
                                    "options": {
                                        "text": "Please provide an AAD User Object ID of the user for which you want to deploy an Azure Machine Learning Compute Instance (CI). The public SSH key is optional and allows the user to to connect to the CI using VS Code.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "machineLearningComputeInstance001AdministratorObjectId",
                                    "label": "ML Compute Instance Admin Object ID",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableComputeInstance, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Specify an AAD User Object ID of a the user in your AAD tenant for whom a Compute Instance should be deployed.",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9-]{36}$",
                                        "validationMessage": "The Object ID consists of 36 lowercase characters, numbers and hyphens."
                                    }
                                },
                                {
                                    "name": "machineLearningComputeInstance001AdministratorPublicSshKey",
                                    "label": "ML Compute Instance Admin Public SSH Key",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableComputeInstance, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Specify a Public SSH Key for the Compute Instance that will be deployed in order to be able to connect to it via Visual Studio Code.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": ""
                                    }
                                },
                                {
                                    "name": "enableDatabricks",
                                    "label": "Connect Machine Learning with Databricks",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'Yes' is selected, you are required to select a Databricks workspace and provide a Databricks Access token.",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "infoBoxDatabricks",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableDatabricks, 'yes')]",
                                    "options": {
                                        "text": "As per Enterprise Scale Analytics recommendation, we are advising to use shared Databricks workspaces. Please select the shared product Databricks workspace in your Data Landing Zone and provide an access token to connect the workspace with Machine Learning. Leave blank, if you don't want to connect Databricks and Machine Learning.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "databricksApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Databricks/workspaces?api-version=2018-04-01')]"
                                    }
                                },
                                {
                                    "name": "databricksId",
                                    "label": "Databricks Workspace",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableDatabricks, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Databricks Workspace which you want to connect to Machine Learning.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('generalSettings').machineLearningSettings.databricksApi.value,(item) => equals(item.location, steps('basics').deploymentDetails.locationName)),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "databricksWorkspaceUrl",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').machineLearningSettings.databricksId, '?api-version=2018-04-01')]"
                                    }
                                },
                                {
                                    "name": "databricksAccessToken",
                                    "label": {
                                        "password": "Databricks Access Token",
                                        "confirmPassword": "Confirm Databricks Access Token"
                                    },
                                    "type": "Microsoft.Common.PasswordBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableDatabricks, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Specify an Azure Databricks Access Token from the workspace selected above to connect Machine Learning and Databricks.",
                                    "constraints": {
                                        "required": true
                                    },
                                    "options": {
                                        "hideConfirmation": true
                                    }
                                },
                                {
                                    "name": "enableAks",
                                    "label": "Connect Machine Learning with an Azure Kubernetes Cluster",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'Yes' is selected, you are required to select an existing AKS Cluster.",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "infoBoxAks",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableAks, 'yes')]",
                                    "options": {
                                        "text": "Select an existing Kubernetes Cluster to connect Machine Learning with the cluster for model deployments. Please be aware that an AKS Cluster can only be connected with a single Machine Learning workspace.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "aksApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.ContainerService/managedClusters?api-version=2021-05-01')]"
                                    }
                                },
                                {
                                    "name": "aksId",
                                    "label": "AKS Cluster",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').machineLearningSettings.enableAks, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Select an AKS cluster to connect it to Machine Learning for model deployments.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('generalSettings').machineLearningSettings.aksApi.value,(item) => equals(item.location, steps('basics').deploymentDetails.locationName)),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataProcessingServiceDeploymentSettings",
							"label": "Data Processing Service Deployment",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "infoBoxProcessingService",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Select a processing engine that you want to deploy as part of the Data Product. The service can not only be used as an additional data processing engine, but also as a workflow orchestration engine to orchestrate and trigger workflows and pipelines within Machine Learning.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "processingService",
                                    "label": "Create Data Processing Service",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Data Factory",
                                    "toolTip": "Specify an additional data processing engine that you want to deploy. This can be used as Spark engine as well as for workflow orchestration.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Data Factory",
                                                "description": "Select if you want to deploy a Data Factory.",
                                                "value": "dataFactory"
                                            },
                                            {
                                                "label": "Synapse",
                                                "description": "Select if you want to deploy a Synapse workspace.",
                                                "value": "synapse"
                                            }
                                        ],
                                        "required": true
                                    }
                                },
                                {
                                    "name": "administratorPassword",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "type": "Microsoft.Common.PasswordBox",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": "Specify an administrator password for the Synapse workspace.",
                                    "constraints": {
                                        "required": true,
                                        "customPasswordRegex": "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{12,}$",
                                        "customValidationMessage": "The password must be alphanumeric, contain at least 12 characters, and have at least 1 letter and 1 number."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountId",
                                    "label": "Synapse Default Storage Account",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Storage account to which you want to connect Synapse.",
                                    "resourceType": "Microsoft.Storage/storageAccounts",
                                    "constraints": {
                                        "required": true
                                    },
                                    "options": {
                                        "filter": {
                                            "subscription": "onBasics",
                                            "location": "onBasics"
                                        }
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').dataProcessingServiceDeploymentSettings.synapseDefaultStorageAccountId.id, '/blobServices/default/containers?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemId",
                                    "label": "Synapse Default Storage Account Container",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": "Default storage container for the Synapse workspace. If no option is shown, please make sure that a container exists within the storage account selected above.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('generalSettings').dataProcessingServiceDeploymentSettings.synapseDefaultStorageAccountFileSystemApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxRoleAssignment",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "options": {
                                        "text": "The role assignment is optional and will assign the Synapse MSI to the selected storage account container (Storage Blob Data Contributor). This option is also required to setup the connection between Machine Learning and Synapse (Contributor).",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "enableRoleAssignments",
                                    "label": "Enable role assignments",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": false,
                                    "toolTip": "Enable role assignments.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable role assignments of Synapse to storage account (Storage Blob Data Contributor) and of Machine Learning to Synapse (Contributor)."
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataGovernance",
							"label": "Data Governance",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "purviewId",
                                    "label": "Connect to Purview Account",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Purview account to which you want to connect Synapse or Data Factory.",
                                    "resourceType": "Microsoft.Purview/accounts",
                                    "required": true,
                                    "options": {
                                        "filter": {
                                            "subscription": "all",
                                            "location": "all"
                                        }
                                    }
                                }
                            ]
                        }
					]
				},
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity Settings",
                    "subLabel": {
                        "preValidation": "Provide the connectivity settings that should be used for the Data Product.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
                            "name": "infoBoxVirtualNetwork",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Please select the Virtual Network of your Data Landing Zone and select a free Subnet within the Virtual Network to make sure that you have proper outbound connectivity as well as DNS name resolution in place. The subnet must have 'privateEndpointNetworkPolicies' and 'privateLinkServiceNetworkPolicies' set to disabled. This is already pre-configured for you in the DataProduct and DataIntegration subnets in the Data Landing Zone Vnet.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "vnet",
                            "label": {
                                "virtualNetwork": "Virtual network",
                                "subnets": "Subnet"
                            },
                            "type": "Microsoft.Network.VirtualNetworkCombo",
                            "visible": true,
                            "toolTip": {
                                "virtualNetwork": "Virtual Network for Data Product",
                                "subnets": "Subnet for Data Product"
                            },
                            "defaultValue": {
                                "name": "",
                                "addressPrefixSize": "/27"
                            },
                            "constraints": {
                                "minAddressPrefixSize": "/27"
                            },
                            "options": {
                                "hideExisting": false
                            },
                            "subnets": {
                                "subnet1": {
                                    "label": "Data Product Subnet",
                                    "defaultValue": {
                                        "name": "dataproductSubnet",
                                        "addressPrefixSize": "/27"
                                    },
                                    "constraints": {
                                        "minAddressPrefixSize": "/27",
                                        "minAddressCount": 13,
                                        "requireContiguousAddresses": true
                                    }
                                }
                            },
                            "scope": {
                                "subscriptionId": "[last(split(steps('basics').deploymentDetails.subscriptionId, '/'))]",
                                "location": "[steps('basics').deploymentDetails.locationName]"
                            }
                        },
                        {
							"name": "privateDnsZones",
							"label": "Private DNS Zones",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "infoBoxPrivateDnsZone",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We are deploying all services with private endpoints and disabled public network access to reduce the data exfiltration risk. For each private endpoint, DNS A-records need to be created in a Private DNS Zones. Therefore, you have to provide the Private DNS Zones that should be used for this deployment. We are assuming that all Private DNS Zones are created in the same subscription.",
                                        "style": "Info"
                                    }
                                },
                                {
									"name": "privateDnsZonesSub",
									"label": "Private DNS Zone Subscription",
									"type":"Microsoft.Common.SubscriptionSelector",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Subscription of Private DNS Zones."
								},
                                {
                                    "name": "privateDnsZonesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat('/subscriptions/', steps('connectivitySettings').privateDnsZones.privateDnsZonesSub.subscriptionId, '/providers/Microsoft.Network/privateDnsZones?api-version=2018-09-01')]"
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdKeyVault",
                                    "label": "Private DNS Zone Key Vault (privatelink.vaultcore.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Key Vault (privatelink.vaultcore.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.vaultcore.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseDev",
                                    "label": "Private DNS Zone Synapse Dev (privatelink.dev.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Dev (privatelink.dev.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.dev.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseSql",
                                    "label": "Private DNS Zone Synapse Sql (privatelink.sql.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Sql (privatelink.sql.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.sql.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdDataFactory",
                                    "label": "Private DNS Zone DataFactory (privatelink.datafactory.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'dataFactory')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for DataFactory (privatelink.datafactory.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.datafactory.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdDataFactoryPortal",
                                    "label": "Private DNS Zone DataFactory Portal (privatelink.adf.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'dataFactory')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for DataFactory Portal (privatelink.adf.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.adf.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdCognitiveService",
                                    "label": "Private DNS Zone Cognitive Service (privatelink.cognitiveservices.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Cognitive Service (privatelink.cognitiveservices.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.cognitiveservices.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdContainerRegistry",
                                    "label": "Private DNS Zone Container Registry (privatelink.azurecr.io)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Container Registry (privatelink.azurecr.io).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.azurecr.io')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSearch",
                                    "label": "Private DNS Zone Azure Search (privatelink.search.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Azure Search (privatelink.search.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.search.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdBlob",
                                    "label": "Private DNS Zone Blob Storage (privatelink.blob.core.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Blob Storage (privatelink.blob.core.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.blob.core.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdFile",
                                    "label": "Private DNS Zone File Storage (privatelink.file.core.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for File Storage (privatelink.file.core.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.file.core.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdMachineLearningApi",
                                    "label": "Private DNS Zone Machine Learning (privatelink.api.azureml.ms)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Machine Learning (privatelink.api.azureml.ms).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.api.azureml.ms')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdMachineLearningNotebooks",
                                    "label": "Private DNS Zone Machine Learning Notebooks (privatelink.notebooks.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Machine Learning Notebooks (privatelink.notebooks.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.notebooks.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
							]
						}
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "ResourceGroup",
            "location": "[steps('basics').deploymentDetails.locationName]",
            "resourceGroupId": "[steps('basics').deploymentDetails.resourceGroupId]",
            "parameters": {
                "location": "[if(empty(steps('basics').deploymentDetails.locationName), '', steps('basics').deploymentDetails.locationName)]",
                "environment": "[if(empty(steps('basics').dataProductName.environment), '', steps('basics').dataProductName.environment)]",
                "prefix": "[if(empty(steps('basics').dataProductName.dataProductPrefix), '', steps('basics').dataProductName.dataProductPrefix)]",
                "processingService": "[if(empty(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService), '', steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService)]",
                "aksId": "[steps('generalSettings').machineLearningSettings.aksId]",
                "machineLearningComputeInstance001AdministratorObjectId": "[if(empty(steps('generalSettings').machineLearningSettings.machineLearningComputeInstance001AdministratorObjectId), '', steps('generalSettings').machineLearningSettings.machineLearningComputeInstance001AdministratorObjectId)]",
                "machineLearningComputeInstance001AdministratorPublicSshKey": "[if(empty(steps('generalSettings').machineLearningSettings.machineLearningComputeInstance001AdministratorPublicSshKey), '', steps('generalSettings').machineLearningSettings.machineLearningComputeInstance001AdministratorPublicSshKey)]",
                "administratorPassword": "[if(empty(steps('generalSettings').dataProcessingServiceDeploymentSettings.administratorPassword), '', steps('generalSettings').dataProcessingServiceDeploymentSettings.administratorPassword)]",
                "synapseDefaultStorageAccountFileSystemId": "[if(empty(steps('generalSettings').dataProcessingServiceDeploymentSettings.synapseDefaultStorageAccountFileSystemId), '', steps('generalSettings').dataProcessingServiceDeploymentSettings.synapseDefaultStorageAccountFileSystemId)]",
                "purviewId": "[if(empty(steps('generalSettings').dataGovernance.purviewId.id), '', steps('generalSettings').dataGovernance.purviewId.id)]",
                "databricksWorkspaceId": "[if(empty(steps('generalSettings').machineLearningSettings.databricksId.id), '', steps('generalSettings').machineLearningSettings.databricksId.id)]",
                "databricksWorkspaceUrl": "[if(empty(steps('generalSettings').machineLearningSettings.databricksWorkspaceUrl.properties.workspaceUrl), '', steps('generalSettings').machineLearningSettings.databricksWorkspaceUrl.properties.workspaceUrl)]",
                "databricksAccessToken": "[if(empty(steps('generalSettings').machineLearningSettings.databricksAccessToken), '', steps('generalSettings').machineLearningSettings.databricksAccessToken)]",
                "enableRoleAssignments": "[if(empty(steps('generalSettings').dataProcessingServiceDeploymentSettings.enableRoleAssignments), false, steps('generalSettings').dataProcessingServiceDeploymentSettings.enableRoleAssignments)]",
                "subnetId": "[if(empty(steps('connectivitySettings').vnet.subnets.subnet1.name), '', concat(steps('basics').deploymentDetails.subscriptionId, '/resourceGroups/', steps('connectivitySettings').vnet.resourceGroup, '/providers/Microsoft.Network/virtualNetworks/', steps('connectivitySettings').vnet.name, '/subnets/', steps('connectivitySettings').vnet.subnets.subnet1.name))]",
                "privateDnsZoneIdKeyVault": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault)]",
                "privateDnsZoneIdSynapseDev": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev)]",
                "privateDnsZoneIdSynapseSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql)]",
                "privateDnsZoneIdDataFactory": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactory), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactory)]",
                "privateDnsZoneIdDataFactoryPortal": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactoryPortal), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdDataFactoryPortal)]",
                "privateDnsZoneIdCognitiveService": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCognitiveService), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCognitiveService)]",
                "privateDnsZoneIdContainerRegistry": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdContainerRegistry), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdContainerRegistry)]",
                "privateDnsZoneIdSearch": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSearch), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSearch)]",
                "privateDnsZoneIdBlob": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdBlob), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdBlob)]",
                "privateDnsZoneIdFile": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdFile), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdFile)]",
                "privateDnsZoneIdMachineLearningApi": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMachineLearningApi), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMachineLearningApi)]",
                "privateDnsZoneIdMachineLearningNotebooks": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMachineLearningNotebooks), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdMachineLearningNotebooks)]"
            }
        }
    }
}